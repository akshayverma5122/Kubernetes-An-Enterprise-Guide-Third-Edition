Learning Repo - https://github.com/PacktPublishing/Kubernetes-An-Enterprise-Guide-Third-Edition

Layer 4 load balancer options:-
------------------------------

HAProxy
NGINX Pro
Seesaw
F5 Networks
MetalLB

MetalLB:-
--------

MetalLB components:-

1. Controller
2. Speaker

Advertising all the IP addresspool and Creating a LoadBalancer service:-
-----------------------------------------------------------------------

1. Get the Network range which is being used by the docker and create the IPAddressPool custom resource.

docker network inspect kind | grep -i subnet  
vim metallb-pool.yaml
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: pool-01
  namespace: metallb-system
spec:
  addresses:
  - 172.18.10.10-172.18.10.20

kubectl create -f metallb-pool.yaml 
kubectl get ipaddresspool

2. create the L2Advertisement which will advertise the list of IP address. This will advertise all the ip address pool becase we have not mentioned the pool info in manifest file. 

kubectl create -f https://raw.githubusercontent.com/akshayverma5122/Kubernetes-An-Enterprise-Guide-Third-Edition/refs/heads/main/chapter4/metallb/l2advertisement.yaml
kubectl get L2Advertisement

3. Restart the controller to take the effect of newly created advertisement. 

kubectl  rollout restart  deploy controller

4. create the nginx deployment 

kubectl create deploy myapp01 --image=nginx --replicas=1

5. Generate the yaml file for load balancer service and create the lb service for nginx deployment. 

kubectl create svc loadbalancer myapp01-lb --tcp=80:80 --dry-run=client -o yaml > myapp01-lb.yaml
kubectl create -f myapp01-lb.yaml  >>>> change the selector value in myapp01-lb.yaml and then execute this command
kubectl get svc myapp01-lb   >>>> check the external ip 
kubectl describe myapp01-lb  >>>> check the endpoint details of the service 

6. test the service using below curl command with external-ip of LB. 

curl <LB IP>

Advertising specific IP addresspool and Creating a LoadBalancer service:-
-----------------------------------------------------------------------

1. Create the two ip address pool with name pool-01 and pool-02. 

kubectl create -f https://raw.githubusercontent.com/akshayverma5122/Kubernetes-An-Enterprise-Guide-Third-Edition/refs/heads/main/chapter4/metallb/metallb-pool-template1.yaml
kubectl create -f https://raw.githubusercontent.com/akshayverma5122/Kubernetes-An-Enterprise-Guide-Third-Edition/refs/heads/main/chapter4/metallb/metallb-pool-template2.yaml

